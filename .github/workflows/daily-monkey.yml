name: Daily Monkey Puzzle

on:
  schedule:
    # Runs every day at 05:00 UTC (midnight EST)
    - cron: '0 5 * * *'
  # Enable manual triggering from the GitHub UI
  workflow_dispatch:

jobs:
  rotate:
    runs-on: ubuntu-latest

    steps:
      - name: Call rotate-monkey endpoint
        run: |
          echo "Calling rotate-monkey endpoint..."
          response=$(curl -X POST \
            -L \
            -f \
            -w "\nHTTP Status: %{http_code}\n" \
            -H "x-cron-secret: ${{ secrets.CRON_SECRET }}" \
            -H "Content-Type: application/json" \
            ${{ secrets.APP_URL }}/api/rotate-monkey)

          echo "Response:"
          echo "$response"

          if [ $? -eq 0 ]; then
            echo "Successfully rotated monkey puzzle!"
          else
            echo "Failed to rotate monkey puzzle"
            exit 1
          fi
